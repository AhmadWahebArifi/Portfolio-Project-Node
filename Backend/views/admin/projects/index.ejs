<div class="d-flex justify-content-between align-items-center mb-4 animate-on-scroll">
  <h2><i class="fas fa-folder me-2"></i> Projects Management</h2>
  <a href="/admin/projects/new" class="btn btn-admin-primary rounded-pill">
    <i class="fas fa-plus me-1"></i> Add New Project
  </a>
</div>

<div class="admin-card animate-on-scroll">
  <div class="card-header bg-transparent border-0 py-3">
    <div class="row align-items-center">
      <div class="col">
        <h6 class="mb-0">Total Projects: <%= totalCount %></h6>
      </div>
    </div>
  </div>

  <% if (projects.length > 0) { %>
  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Title</th>
          <th>Category</th>
          <th>Status</th>
          <th>Featured</th>
          <th>Public</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% projects.forEach(function(project) { %>
        <tr>
          <td>
            <div class="d-flex align-items-center">
              <div>
                <h6 class="mb-0"><%= project.title %></h6>
                <small class="text-muted"
                  ><%= project.description.substring(0, 50) %>...</small
                >
              </div>
            </div>
          </td>
          <td>
            <span class="badge bg-secondary text-capitalize rounded-pill"
              ><%= project.category %></span
            >
          </td>
          <td>
            <span
              class="badge bg-<%= project.status === 'completed' ? 'success' : project.status === 'in-progress' ? 'warning' : 'info' %> rounded-pill"
            >
              <%= project.status.replace('-', ' ').replace(/\b\w/g, l =>
              l.toUpperCase()) %>
            </span>
          </td>
          <td>
            <% if (project.featured) { %>
            <i class="fas fa-star text-warning"></i>
            <% } else { %>
            <i class="far fa-star text-muted"></i>
            <% } %>
          </td>
          <td>
            <% if (project.isPublic) { %>
            <i class="fas fa-eye text-success"></i>
            <% } else { %>
            <i class="fas fa-eye-slash text-muted"></i>
            <% } %>
          </td>
          <td>
            <small class="text-muted"
              ><%= moment(project.createdAt).format('MMM DD, YYYY') %></small
            >
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <a
                href="/admin/projects/<%= project.id %>"
                class="btn btn-outline-info rounded-circle me-1"
                title="View Details"
              >
                <i class="fas fa-eye"></i>
              </a>
              <a
                href="/projects/<%= project.id %>"
                class="btn btn-outline-secondary rounded-circle me-1"
                target="_blank"
                title="View Public Page"
              >
                <i class="fas fa-external-link-alt"></i>
              </a>
              <a
                href="/admin/projects/<%= project.id %>/edit"
                class="btn btn-outline-primary rounded-circle me-1"
                title="Edit"
              >
                <i class="fas fa-edit"></i>
              </a>
              <form
                action="/admin/projects/<%= project.id %>"
                method="POST"
                class="d-inline delete-form"
                data-project-title="<%= project.title %>"
              >
                <input type="hidden" name="_method" value="DELETE" />
                <button
                  type="submit"
                  class="btn btn-outline-danger rounded-circle"
                  title="Delete"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </form>
            </div>
          </td>
        </tr>
        <% }); %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if (totalPages > 1) { %>
  <div class="card-footer bg-transparent">
    <nav>
      <ul class="pagination justify-content-center mb-0">
        <% if (currentPage > 1) { %>
        <li class="page-item">
          <a
            class="page-link rounded-pill"
            href="/admin/projects?page=<%= currentPage - 1 %>"
            >Previous</a
          >
        </li>
        <% } %> <% for (let i = Math.max(1, currentPage - 2); i <=
        Math.min(totalPages, currentPage + 2); i++) { %>
        <li class="page-item <%= i === currentPage ? 'active' : '' %>">
          <a class="page-link rounded-pill" href="/admin/projects?page=<%= i %>"><%= i %></a>
        </li>
        <% } %> <% if (currentPage < totalPages) { %>
        <li class="page-item">
          <a
            class="page-link rounded-pill"
            href="/admin/projects?page=<%= currentPage + 1 %>"
            >Next</a
          >
        </li>
        <% } %>
      </ul>
    </nav>
  </div>
  <% } %> <% } else { %>
  <div class="card-body text-center py-5">
    <div class="mb-3">
      <i class="fas fa-folder-open fa-3x text-muted"></i>
    </div>
    <h5>No Projects Found</h5>
    <p class="text-muted">Start by creating your first project.</p>
    <a href="/admin/projects/new" class="btn btn-admin-primary rounded-pill">
      <i class="fas fa-plus me-1"></i> Add First Project
    </a>
  </div>
  <% } %>
</div>

<script>
  // Enhanced delete confirmation
  document.addEventListener("DOMContentLoaded", function () {
    const deleteForms = document.querySelectorAll(".delete-form");

    deleteForms.forEach(function (form) {
      form.addEventListener("submit", function (e) {
        const projectTitle = form.getAttribute("data-project-title");
        const confirmMessage = `Are you sure you want to delete the project "${projectTitle}"?\n\nThis action cannot be undone.`;

        if (!confirm(confirmMessage)) {
          e.preventDefault();
          return;
        }

        // Show loading state
        const deleteBtn = form.querySelector('button[type="submit"]');
        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        deleteBtn.disabled = true;
      });
    });
  });
</script>

<style>
  .table > :not(caption) > * > * {
    padding: 1rem 1.5rem;
    vertical-align: middle;
  }
  
  .table thead th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 0.5px;
  }
  
  .btn-group .btn {
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    border-radius: 50% !important;
  }
  
  .page-link {
    border-radius: var(--radius-full) !important;
    margin: 0 0.25rem;
    border: none;
    color: var(--admin-dark);
    transition: var(--transition);
  }
  
  .page-link:hover {
    background: var(--admin-secondary);
    color: white;
  }
  
  .page-item.active .page-link {
    background: var(--admin-secondary);
    color: white;
    border: none;
  }
</style>