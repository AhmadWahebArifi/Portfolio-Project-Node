<% if (typeof layout === 'undefined' || layout === 'none') { %>
<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
<% } %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h2><i class="fas fa-blog"></i> <%= blog.id ? 'Edit' : 'Write New' %> Blog Post</h2>
  <a href="/admin/blog" class="btn btn-outline-secondary">
    <i class="fas fa-arrow-left"></i> Back to Blog
  </a>
</div>

<div class="card">
  <div class="card-body">
    <form action="<%= action %>" method="POST">
      <% if (method === 'PUT') { %>
      <input type="hidden" name="_method" value="PUT">
      <% } %>

      <div class="mb-3">
        <label for="title" class="form-label">Post Title *</label>
        <input
          type="text"
          class="form-control"
          id="title"
          name="title"
          value="<%= blog.title || '' %>"
          required
        />
      </div>

      <div class="mb-3">
        <label for="excerpt" class="form-label">Excerpt *</label>
        <textarea
          class="form-control"
          id="excerpt"
          name="excerpt"
          rows="3"
          placeholder="Brief description of the blog post..."
          required
        ><%= blog.excerpt || '' %></textarea>
      </div>

      <div class="mb-3">
        <label for="content" class="form-label">Content *</label>
        <textarea
          class="form-control"
          id="content"
          name="content"
          rows="15"
          placeholder="Write your blog post content here... (minimum 20 characters)"
          required
        ><%= blog.content || '' %></textarea>
        <div class="form-text">Content must be at least 20 characters long</div>
      </div>

      <div class="mb-3">
        <label for="category" class="form-label">Category *</label>
        <select class="form-select" id="category" name="category" required>
          <option value="">Select Category</option>
          <option value="technology" <%= blog.category === 'technology' ? 'selected' : '' %>>Technology</option>
          <option value="web-development" <%= blog.category === 'web-development' ? 'selected' : '' %>>Web Development</option>
          <option value="programming" <%= blog.category === 'programming' ? 'selected' : '' %>>Programming</option>
          <option value="tutorials" <%= blog.category === 'tutorials' ? 'selected' : '' %>>Tutorials</option>
          <option value="career" <%= blog.category === 'career' ? 'selected' : '' %>>Career</option>
          <option value="personal" <%= blog.category === 'personal' ? 'selected' : '' %>>Personal</option>
          <option value="other" <%= blog.category === 'other' ? 'selected' : '' %>>Other</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="tags" class="form-label">Tags</label>
        <input
          type="text"
          class="form-control"
          id="tags"
          name="tags"
          placeholder="Enter tags separated by commas"
          value="<%= Array.isArray(blog.tags) ? blog.tags.join(', ') : (typeof blog.tags === 'string' ? blog.tags : '') %>"
        />
        <div class="form-text">Separate tags with commas (e.g., javascript, nodejs, express)</div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <a href="/admin/blog" class="btn btn-outline-secondary">Cancel</a>
        <button type="submit" name="status" value="draft" class="btn btn-outline-warning">
          <i class="fas fa-save"></i> Save as Draft
        </button>
        <button type="submit" name="status" value="published" class="btn btn-primary">
          <i class="fas fa-paper-plane"></i> <%= blog.id ? 'Update' : 'Publish' %> Post
        </button>
      </div>
    </form>
  </div>
</div>

<script>
// Add client-side validation to help users
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  const contentField = document.getElementById('content');
  
  form.addEventListener('submit', function(e) {
    if (contentField.value.trim().length < 20) {
      e.preventDefault();
      alert('Content must be at least 20 characters long');
      contentField.focus();
      return false;
    }
  });
});
</script>

<% if (typeof layout === 'undefined' || layout === 'none') { %>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<% } %>