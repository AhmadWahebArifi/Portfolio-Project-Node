<!-- Header Section -->
<section class="py-5 mt-5 bg-light">
  <div class="container">
    <div class="text-center animate-on-scroll">
      <h1 class="display-4 fw-bold">My Projects</h1>
      <p class="lead">
        A showcase of my work and the technologies I've used to bring ideas to
        life.
      </p>
    </div>
  </div>
</section>

<!-- Filter Section -->
<section class="py-4 border-bottom">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <div class="btn-group flex-wrap" role="group">
          <a
            href="/projects"
            class="btn <%= selectedCategory === '' ? 'btn-primary' : 'btn-outline-primary' %> rounded-pill me-2 mb-2"
          >
            All Projects
          </a>
          <% categories.forEach(function(category) { %>
          <a
            href="/projects?category=<%= category %>"
            class="btn <%= selectedCategory === category ? 'btn-primary' : 'btn-outline-primary' %> rounded-pill me-2 mb-2"
          >
            <%= category.charAt(0).toUpperCase() + category.slice(1) %>
          </a>
          <% }); %>
        </div>
      </div>
      <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
        <span class="text-muted">
          <i class="fas fa-folder"></i> <%= projects.length %> Project<%=
          projects.length !== 1 ? 's' : '' %>
        </span>
      </div>
    </div>
  </div>
</section>

<!-- Projects Grid -->
<section class="py-5">
  <div class="container">
    <!-- Skeleton loading for projects -->
    <div id="projects-skeleton" class="projects-skeleton" style="display: none">
      <div class="row">
        <% for(let i = 0; i < 6; i++) { %>
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="card h-100 project-card skeleton-card">
            <div class="skeleton-image"></div>
            <div class="card-body">
              <div class="skeleton-text skeleton-title mb-2"></div>
              <div class="skeleton-text mb-3"></div>
              <div class="skeleton-text skeleton-sm mb-3"></div>
              <div class="skeleton-buttons">
                <div class="skeleton-btn"></div>
              </div>
            </div>
          </div>
        </div>
        <% } %>
      </div>
    </div>

    <!-- Actual projects content -->
    <div id="projects-content">
      <% if (projects.length > 0) { %>
      <div class="row">
        <% projects.forEach(function(project, index) { %>
        <div class="col-lg-4 col-md-6 mb-4 animate-on-scroll" <% if (index>
          0) { %>style="animation-delay: <%= index * 0.1 %>s;"<% } %> >
          <div class="card h-100 project-card">
            <% if (project.images && Array.isArray(project.images) &&
            project.images.length > 0) { %>
            <div class="position-relative overflow-hidden">
              <img
                src="<%= project.images[0].url %>"
                class="card-img-top project-image"
                alt="<%= project.images[0].alt || project.title %>"
                loading="lazy"
              />
              <div class="project-overlay">
                <div class="project-actions">
                  <% if (project.liveUrl) { %>
                  <a
                    href="<%= project.liveUrl %>"
                    target="_blank"
                    class="btn btn-light btn-sm rounded-circle me-2"
                    title="Live Demo"
                  >
                    <i class="fas fa-external-link-alt"></i>
                  </a>
                  <% } %> <% if (project.githubUrl) { %>
                  <a
                    href="<%= project.githubUrl %>"
                    target="_blank"
                    class="btn btn-dark btn-sm rounded-circle"
                    title="Source Code"
                  >
                    <i class="fab fa-github"></i>
                  </a>
                  <% } %>
                </div>
              </div>
            </div>
            <% } else { %>
            <div
              class="card-img-top bg-light d-flex align-items-center justify-content-center"
              style="height: 200px"
            >
              <i class="fas fa-code fa-3x text-muted"></i>
            </div>
            <% } %>

            <div class="card-body d-flex flex-column">
              <div
                class="d-flex justify-content-between align-items-start mb-2"
              >
                <h5 class="card-title mb-0"><%= project.title %></h5>
                <% if (project.featured) { %>
                <span class="badge bg-warning text-dark ms-2">
                  <i class="fas fa-star"></i> Featured
                </span>
                <% } %>
              </div>

              <div class="mb-2">
                <small class="text-muted">
                  <i class="fas fa-tag"></i>
                  <%= project.category.charAt(0).toUpperCase() +
                  project.category.slice(1) %>
                  <span class="ms-2">
                    <i class="fas fa-circle status-<%= project.status %>"></i>
                    <%= project.status.charAt(0).toUpperCase() +
                    project.status.slice(1).replace('-', ' ') %>
                  </span>
                </small>
              </div>

              <p class="card-text flex-grow-1"><%= project.description %></p>

              <div class="mb-3">
                <small class="text-muted d-block mb-2">Technologies:</small>
                <% const techs = Array.isArray(project.technologies) ?
                project.technologies : (typeof project.technologies === 'string'
                ? JSON.parse(project.technologies || '[]') : []); %> <%
                techs.forEach(function(tech, index) { %>
                <span class="badge bg-secondary me-1 mb-1"><%= tech %></span>
                <% }); %>
              </div>

              <div class="d-grid">
                <a href="/projects/<%= project.id %>" class="btn btn-primary rounded-pill">
                  <i class="fas fa-eye"></i> View Details
                </a>
              </div>
            </div>
          </div>
        </div>
        <% }); %>
      </div>

      <!-- Pagination -->
      <% if (totalPages > 1) { %>
      <nav aria-label="Projects pagination" class="mt-5">
        <ul class="pagination justify-content-center flex-wrap">
          <% if (currentPage > 1) { %>
          <li class="page-item">
            <a
              class="page-link rounded-pill me-1 mb-1"
              href="/projects?page=<%= currentPage - 1 %><%= selectedCategory ? '&category=' + selectedCategory : '' %>"
            >
              <i class="fas fa-chevron-left"></i> Previous
            </a>
          </li>
          <% } %> <% for (let i = Math.max(1, currentPage - 2); i <=
          Math.min(totalPages, currentPage + 2); i++) { %>
          <li class="page-item <%= i === currentPage ? 'active' : '' %>">
            <a
              class="page-link rounded-pill me-1 mb-1"
              href="/projects?page=<%= i %><%= selectedCategory ? '&category=' + selectedCategory : '' %>"
            >
              <%= i %>
            </a>
          </li>
          <% } %> <% if (currentPage < totalPages) { %>
          <li class="page-item">
            <a
              class="page-link rounded-pill me-1 mb-1"
              href="/projects?page=<%= currentPage + 1 %><%= selectedCategory ? '&category=' + selectedCategory : '' %>"
            >
              Next <i class="fas fa-chevron-right"></i>
            </a>
          </li>
          <% } %>
        </ul>
      </nav>
      <% } %> <% } else { %>
      <div class="text-center py-5">
        <div class="mb-4">
          <i class="fas fa-folder-open fa-5x text-muted"></i>
        </div>
        <h3>No Projects Found</h3>
        <p class="text-muted">
          <% if (selectedCategory) { %> No projects found in the "<%=
          selectedCategory %>" category. <% } else { %> No projects available at
          the moment. <% } %>
        </p>
        <% if (selectedCategory) { %>
        <a href="/projects" class="btn btn-primary rounded-pill">
          <i class="fas fa-list"></i> View All Projects
        </a>
        <% } %>
      </div>
      <% } %>
    </div>
  </div>
</section>

<style>
  .project-card {
    transition: all 0.3s cubic-bezier(0.22, 0.61, 0.36, 1);
    border: none;
    box-shadow: var(--shadow);
    border-radius: var(--radius-lg);
    overflow: hidden;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .project-card:hover {
    transform: translateY(-10px);
    box-shadow: var(--shadow-xl);
  }

  .project-image {
    height: 200px;
    object-fit: cover;
    transition: all 0.3s ease;
  }

  .project-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
  }

  .project-card:hover .project-overlay {
    opacity: 1;
  }

  .project-card:hover .project-image {
    transform: scale(1.1);
  }

  .project-actions .btn {
    transition: all 0.3s ease;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .project-actions .btn:hover {
    transform: scale(1.1);
  }

  .status-completed {
    color: var(--success);
  }

  .status-in-progress {
    color: var(--warning);
  }

  .status-planning {
    color: var(--gray-500);
  }

  .status-on-hold {
    color: var(--danger);
  }

  .badge {
    font-size: 0.75em;
    padding: 0.5em 0.75em;
    border-radius: var(--radius-full);
  }

  .btn-group .btn {
    border-radius: var(--radius-full) !important;
    margin-right: 0.5rem;
    margin-bottom: 0.5rem;
    border: 2px solid transparent;
  }

  .btn-group .btn.btn-outline-primary {
    border-color: var(--gray-300);
  }

  .btn-group .btn.btn-outline-primary:hover,
  .btn-group .btn.btn-outline-primary.active {
    border-color: var(--secondary-color);
    background: linear-gradient(135deg, var(--secondary-color) 0%, #0284c7 100%);
    color: white;
  }

  /* Skeleton styles */
  .projects-skeleton {
    opacity: 0.7;
  }

  .skeleton-card {
    border: none;
    box-shadow: var(--shadow);
    border-radius: var(--radius-lg);
  }

  .skeleton-image {
    height: 200px;
    background: linear-gradient(90deg, #e0e0e0, #f5f5f5, #e0e0e0);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }

  .skeleton-text {
    background: linear-gradient(90deg, #e0e0e0, #f5f5f5, #e0e0e0);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: var(--radius-sm);
    height: 1rem;
    margin-bottom: 0.5rem;
  }

  .skeleton-title {
    height: 1.25rem;
    width: 70%;
  }

  .skeleton-sm {
    height: 0.75rem;
    width: 90%;
  }

  .skeleton-buttons {
    margin-top: 1rem;
  }

  .skeleton-btn {
    height: 2.5rem;
    background: linear-gradient(90deg, #e0e0e0, #f5f5f5, #e0e0e0);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: var(--radius-full);
  }

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* Comprehensive Responsive Design for Projects Page */
  /* Extra small devices (phones, less than 576px) */
  @media (max-width: 575.98px) {
    .container {
      padding-right: 1rem;
      padding-left: 1rem;
    }
    
    .display-4 {
      font-size: 1.75rem;
    }
    
    .lead {
      font-size: 0.9rem;
    }
    
    .project-card {
      margin-bottom: 1.5rem;
    }
    
    .project-image {
      height: 150px;
    }
    
    .card-title {
      font-size: 1.1rem;
    }
    
    .btn-group {
      justify-content: center;
    }
    
    .btn-group .btn {
      font-size: 0.8rem;
      padding: 0.375rem 0.75rem;
      margin-right: 0.25rem;
      margin-bottom: 0.25rem;
    }
    
    .pagination .page-link {
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
    
    .text-lg-end {
      text-align: center !important;
    }
    
    .mt-5.pt-5 {
      padding-top: 3rem !important;
    }
  }

  /* Small devices (landscape phones, 576px and up) */
  @media (min-width: 576px) and (max-width: 767.98px) {
    .display-4 {
      font-size: 2rem;
    }
    
    .lead {
      font-size: 1rem;
    }
    
    .project-image {
      height: 175px;
    }
    
    .btn-group .btn {
      font-size: 0.875rem;
      padding: 0.4rem 0.875rem;
    }
  }

  /* Medium devices (tablets, 768px and up) */
  @media (min-width: 768px) and (max-width: 991.98px) {
    .display-4 {
      font-size: 2.25rem;
    }
    
    .lead {
      font-size: 1.1rem;
    }
    
    .project-image {
      height: 180px;
    }
  }

  /* Large devices (desktops, 992px and up) */
  @media (min-width: 992px) and (max-width: 1199.98px) {
    .display-4 {
      font-size: 2.5rem;
    }
    
    .lead {
      font-size: 1.15rem;
    }
  }

  /* Extra large devices (large desktops, 1200px and up) */
  @media (min-width: 1200px) {
    .display-4 {
      font-size: 2.75rem;
    }
    
    .lead {
      font-size: 1.25rem;
    }
  }

  /* General responsive improvements */
  @media (max-width: 768px) {
    .btn-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn-group .btn {
      margin-bottom: 0.5rem;
      margin-right: 0.5rem;
    }
    
    .text-lg-end {
      text-align: center !important;
      margin-top: 1rem;
    }
    
    .border-bottom {
      border-bottom: none !important;
      border-top: 1px solid var(--gray-200);
      padding-top: 1rem;
    }
    
    h1, h2, h3, h4, h5, h6 {
      line-height: 1.3;
    }
    
    .card {
      margin-bottom: 1.5rem;
    }
  }

  /* Responsive fixes for specific components */
  @media (max-width: 576px) {
    .d-flex.justify-content-between {
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .pagination {
      flex-wrap: wrap;
    }
    
    .pagination .page-item {
      margin-bottom: 0.5rem;
    }
    
    .badge {
      font-size: 0.7rem;
      padding: 0.3em 0.6em;
    }
    
    .project-actions .btn {
      width: 35px;
      height: 35px;
      font-size: 0.8rem;
    }
    
    .skeleton-image {
      height: 150px;
    }
    
    .skeleton-btn {
      height: 2.25rem;
    }
  }
</style>

<script>
  // Show skeleton loading while content is being prepared
  document.addEventListener("DOMContentLoaded", function () {
    const projectsSkeleton = document.getElementById("projects-skeleton");
    const projectsContent = document.getElementById("projects-content");

    // Show skeleton initially
    if (projectsSkeleton && projectsContent) {
      projectsSkeleton.style.display = "block";
      projectsContent.style.display = "none";

      // Simulate loading delay
      setTimeout(function () {
        projectsSkeleton.style.display = "none";
        projectsContent.style.display = "block";

        // Initialize animations for projects
        initScrollAnimations();
      }, 300);
    }
  });

  // Optimize scroll animations to reduce CPU usage
  function initScrollAnimations() {
    const animateElements = document.querySelectorAll(".animate-on-scroll");

    // Use IntersectionObserver with better performance options
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("animated");
            // Unobserve to prevent unnecessary callbacks
            observer.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px",
        // Improve performance
        trackVisibility: true,
        delay: 100,
      }
    );

    animateElements.forEach((element) => {
      observer.observe(element);
    });
  }
</script>